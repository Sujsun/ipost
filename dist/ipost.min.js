/**
 * Plugin: ipost
 * Author: Sundarasan Natarajan
 * GIT: https://github.com/Sujsun/ipost.git
 * Version: 0.0.1
 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b){if(!window.parent&&"string"!=typeof a)throw new Error("targetOrigin is missing");this.targetOrigin=a,this.config||(this.config={}),this.config=h(g,b),this._requestPromises||(this._requestPromises={}),this.event=new e}var e=a("minivents"),f={name:"ipost",description:"Eases the way of posting and recieving iframe messages",accessVariable:"ipost",version:"0.0.1"},g={iframeTimeout:1e4};d.prototype.inject=function(){return this._IFrame.apply(this,arguments)},d.prototype.listen=function(){return this._listen.apply(this,arguments)},d.prototype.post=function(a){return this._post.apply(this,arguments)},d.prototype.on=function(a,b){this.event.on(a,b)},d.prototype._IFrame=function(){return this._iframeReadyDeferred||(this._iframeReadyDeferred=this._injectIFrame.apply(this,arguments)),this._iframeReadyDeferred},d.prototype._injectIFrame=function(a,b){var c=$.Deferred(),d=a&&$(a)||$("<iframe/>");return b||(b={}),b.src&&(this.targetOrigin=b.src),d.attr("src",this.targetOrigin),this._isIFrameInjected=!0,d.on("load",function(){window.clearTimeout(this._iframeLoadTimeoutIndex),c.resolve(d.get(0),d)}),$("body").append(d),this._iframeLoadTimeoutIndex=window.setTimeout(function(){var a=new Error;a.type="iframe_load_timeout",a.message="IFrame timed out to load",c.reject(a)},this.config.iframeTimeout),c},d.prototype._post=function(){var a={};return a.id=i.s4(),a.type="ping",a.payload=Array.prototype.slice.call(arguments),a.plugin=f.name,this._requestPromises[a.id]=new $.Deferred,this._postRaw(a),this._requestPromises[a.id]},d.prototype._postRaw=function(a){var b=this;return this.config.child&&window.parent?(window.parent.postMessage(JSON.stringify(a),b.targetOrigin||"*"),$.Deferred().resolve().promise()):this._IFrame().then(function(c,d){return c.contentWindow.postMessage(JSON.stringify(a),b.targetOrigin),$.Deferred().resolve().promise()})},d.prototype._listen=function(a){var b=this;b._isListening||$(window).on("message",function(a){b._messageHandler(a.originalEvent.data)})},d.prototype._postReply=function(a,b){var c=a.state(),d=a._ipostMessage;d.payload=Array.prototype.slice.call(b),"resolved"===c||"rejected"===c?(d.type="pong",d.state=c):d.type="notify",this._postRaw(d)},d.prototype._messageHandler=function(a){var b=this;try{a=JSON.parse(a)}catch(c){return void console.warn("Couldnot parse the received message. Message:",a)}if(a.plugin===f.name)if("ping"===a.type){var d=$.Deferred();d._ipostMessage=a;var d=d.always(function(){b._postReply(d,arguments)}).progress(function(){b._postReply(d,arguments)}),e=[];e.push("message"),e.push(d),e=e.concat(a.payload),this.event.emit.apply(this.event,e)}else{var g=this._requestPromises[a.id];if(g)switch(a.type){case"pong":"resolved"===a.state?g.resolve.apply(g,a.payload):g.reject.apply(g,a.payload),this._removeRequestPromise(a.id);break;case"notify":g.notify.apply(g,a.payload);break;default:console.warn("Unknown message type. messageType:",a.type)}}},d.prototype._removeRequestPromise=function(a){delete this._requestPromises[a]};var h=function(a,b){var c,d={};for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(d[c]=a[c]);for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c]);return d},i={s4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};window.IPost=d,b.exports=d},{minivents:2}],2:[function(a,b,c){b.exports=function(a){var b={},c=[];a=a||this,a.on=function(a,c,d){(b[a]=b[a]||[]).push([c,d])},a.off=function(a,d){a||(b={});for(var e=b[a]||c,f=e.length=d?e.length:0;f--;)d==e[f][0]&&e.splice(f,1)},a.emit=function(a){for(var d,e=b[a]||c,f=0;d=e[f++];)d[0].apply(d[1],c.slice.call(arguments,1))}}},{}]},{},[1]);