/**
 * Plugin: ipost
 * Author: Sundarasan Natarajan
 * GIT: https://github.com/Sujsun/ipost.git
 * Version: 0.0.1
 */

!function o(n,s,p){function a(i,e){if(!s[i]){if(!n[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(u)return u(i,!0);throw new Error("Cannot find module '"+i+"'")}var r=s[i]={exports:{}};n[i][0].call(r.exports,function(e){var t=n[i][1][e];return a(t||e)},r,r.exports,o,n,s,p)}return s[i].exports}for(var u="function"==typeof require&&require,e=0;e<p.length;e++)a(p[e]);return a}({1:[function(e,t,i){var r=e("minivents"),n="ipost",o={iframeTimeout:1e4};function s(e,t){if(!window.parent&&"string"!=typeof e)throw new Error("targetOrigin is missing");this.targetOrigin=e,this.config||(this.config={}),this.config=p(o,t),"string"==typeof this.config.mode||(this.config.mode="iframe"),this._requestPromises||(this._requestPromises={}),this._readyDeferred=$.Deferred(),this.event=new r}s.prototype.inject=function(){return this._IFrame.apply(this,arguments)},s.prototype.open=function(){return this._openPopup.apply(this,arguments)},s.prototype.close=function(){return this._closePopup.apply(this,arguments)},s.prototype.listen=function(){return this._listen.apply(this,arguments)},s.prototype.post=function(e){return this._post.apply(this,arguments)},s.prototype.ready=function(){return this._postReady()},s.prototype.readyDeferred=function(){return this._readyDeferred},s.prototype.on=function(e,t){this.event.on(e,t)},s.prototype._IFrame=function(){return this._iframeReadyDeferred||(this._iframeReadyDeferred=$.when(this._injectIFrame.apply(this,arguments),this._readyDeferred).then(function(e){var t=$.Deferred();return t.resolve.apply(t,e)})),this._iframeReadyDeferred},s.prototype._PopupWindow=function(){return $.when(this._openPopup.apply(this,arguments),this._readyDeferred).then(function(e){var t=$.Deferred();return t.resolve.apply(t,e)})},s.prototype._injectIFrame=function(e,t){var i=$.Deferred(),r=e&&$(e)||$("<iframe/>");return t||(t={}),t.src&&(this.targetOrigin=t.src),r.attr("src",this.targetOrigin),this._isIFrameInjected=!0,r.on("load",function(){window.clearTimeout(this._iframeLoadTimeoutIndex),i.resolve(r.get(0),r)}),$("body").append(r),this._iframeLoadTimeoutIndex=window.setTimeout(function(){var e=new Error;e.type="iframe_load_timeout",e.message="IFrame timed out to load",i.reject(e)},this.config.iframeTimeout),i},s.prototype._openPopup=function(){var e,t=this,i=$.Deferred();return this._isPopupWindowOpen||(e=[this.targetOrigin],"string"==typeof this.config.target&&e.push(this.config.target),"string"==typeof this.config.windowOptions&&e.push(this.config.windowOptions),this._popupWindow=window.open.apply(window,e),this._isPopupWindowOpen=!0,this._popupWindowIntervalIndex=window.setInterval(function(){t._popupWindow.closed&&t._closePopup()},500)),i.resolve(this._popupWindow,$(this._popupWindow)),i.promise()},s.prototype._closePopup=function(){this._popupWindow&&(window.clearInterval(this._popupWindowIntervalIndex),this._popupWindow.close(),delete this._popupWindow,this._isPopupWindowOpen=!1)},s.prototype._postReady=function(){var e={};e.plugin=n,e.type="ready",e.mode=this.config.mode,this._postRaw(e)},s.prototype._post=function(){var e={};return e.id=a.s4(),e.type="ping",e.payload=Array.prototype.slice.call(arguments),e.plugin=n,this._requestPromises[e.id]=new $.Deferred,this._postRaw(e),this._requestPromises[e.id]},s.prototype._postRaw=function(r){var o=this;return this.config.child&&window.parent?(window.parent.postMessage(JSON.stringify(r),o.targetOrigin||"*"),$.Deferred().resolve().promise()):"popup"===this.config.mode&&(this.config.popup||this.config.child)&&window.opener?(window.opener.postMessage(JSON.stringify(r),o.targetOrigin||"*"),$.Deferred().resolve().promise()):"popup"===this.config.mode?this._PopupWindow().then(function(e,t){var i=$.Deferred();try{e.postMessage(JSON.stringify(r),o.targetOrigin),i.resolve()}catch(e){i.reject(e)}return i.promise()}):this._IFrame().then(function(e,t){var i=$.Deferred();try{e.contentWindow.postMessage(JSON.stringify(r),o.targetOrigin),i.resolve()}catch(e){i.reject(e)}return i.promise()})},s.prototype._listen=function(e){var t=this;t._isListening||($(window).on("message",function(e){t._messageHandler(e.originalEvent.data)}),t._isListening=!0)},s.prototype._postReply=function(e,t){var i=e.state(),r=e._ipostMessage;r.payload=Array.prototype.slice.call(t),"resolved"===i||"rejected"===i?(r.type="pong",r.state=i):r.type="notify",this._postRaw(r)},s.prototype._messageHandler=function(t){var e=this;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return void console.warn("Couldnot parse the received message. Message:",t)}if(t.plugin===n)if("ready"===t.type&&this.config.mode===t.mode)this._readyDeferred.resolve(),this.event.emit("ready");else if("ping"===t.type){(i=$.Deferred())._ipostMessage=t;var i=i.always(function(){e._postReply(i,arguments)}).progress(function(){e._postReply(i,arguments)}),r=[];r.push("message"),r.push(i),r=r.concat(t.payload),this.event.emit.apply(this.event,r)}else{var o=this._requestPromises[t.id];if(o)switch(t.type){case"pong":"resolved"===t.state?o.resolve.apply(o,t.payload):o.reject.apply(o,t.payload),this._removeRequestPromise(t.id);break;case"notify":o.notify.apply(o,t.payload);break;default:console.warn("Unknown message type. messageType:",t.type)}}},s.prototype._removeRequestPromise=function(e){delete this._requestPromises[e]};var p=function(e,t){var i,r={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i]);for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i]);return r},a={s4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};window.IPost=s,t.exports=s},{minivents:2}],2:[function(e,t,i){t.exports=function(n){var s={},p=[];(n=n||this).on=function(e,t,i){return(s[e]=s[e]||[]).push([t,i]),n},n.off=function(e,t){e||(s={});for(var i=s[e]||p,r=i.length=t?i.length:0;r--;)t==i[r][0]&&i.splice(r,1);return n},n.emit=function(e){for(var t,i=s[e]||p,r=0<i.length?i.slice(0,i.length):i,o=0;t=r[o++];)t[0].apply(t[1],p.slice.call(arguments,1));return n}}},{}]},{},[1]);